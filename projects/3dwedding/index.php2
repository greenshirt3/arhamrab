<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Wedding Experience</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #D4AF37;
            --dark: #0a0a0a;
        }
        body { margin: 0; overflow: hidden; background: var(--dark); font-family: 'Montserrat', sans-serif; }
        
        /* UI OVERLAY */
        #loader {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; transition: opacity 1s ease;
        }
        .loader-text {
            font-family: 'Cinzel', serif; color: var(--gold); font-size: 2rem; letter-spacing: 5px;
            animation: pulse 2s infinite;
        }
        
        .ui-layer {
            position: absolute; bottom: 40px; width: 100%; text-align: center; pointer-events: none;
        }
        
        .btn-gold {
            background: linear-gradient(45deg, #b8860b, #ffd700, #b8860b);
            background-size: 200% auto;
            color: #000; padding: 15px 40px;
            border: none; border-radius: 50px;
            font-family: 'Cinzel', serif; font-weight: 700; font-size: 1rem; letter-spacing: 2px;
            cursor: pointer; pointer-events: auto;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            transition: all 0.4s ease;
            animation: shine 3s infinite linear;
        }
        .btn-gold:hover { transform: scale(1.1); box-shadow: 0 0 40px rgba(212, 175, 55, 0.8); }

        .brand {
            position: absolute; top: 30px; left: 30px;
            color: rgba(255,255,255,0.3); font-size: 0.8rem; letter-spacing: 3px;
        }

        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        @keyframes shine { to { background-position: 200% center; } }
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "@tweenjs/tween.js": "https://unpkg.com/@tweenjs/tween.js@23.1.1/dist/tween.esm.js"
            }
        }
    </script>
</head>
<body>

    <div id="loader">
        <div class="loader-text">ARHAM PRINTERS</div>
        <div style="color: #666; margin-top: 10px; font-size: 0.8rem;">LOADING 3D ASSETS</div>
    </div>

    <div class="brand">ROYAL COLLECTION</div>

    <div class="ui-layer">
        <button class="btn-gold" onclick="window.toggleCard()">OPEN INVITATION</button>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import * as TWEEN from '@tweenjs/tween.js';

        let scene, camera, renderer, composer, controls;
        let cardGroup, hinge;
        let particles;
        let cardData;
        let isOpen = false;

        // --- 1. INITIALIZATION ---
        init();

        function init() {
            // Scene Setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505); // Deep luxury black
            scene.fog = new THREE.FogExp2(0x050505, 0.03); // Atmospheric fog

            // Camera
            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 2, 12);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.toneMapping = THREE.ReinhardToneMapping;
            document.body.appendChild(renderer.domElement);

            // --- POST PROCESSING (THE GLOW EFFECT) ---
            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
            bloomPass.threshold = 0.2;  // Only bright things glow
            bloomPass.strength = 0.8;   // Intensity of glow
            bloomPass.radius = 0.5;     // Softness

            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // Lighting (Cinematic)
            const ambient = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambient);

            // Gold Spotlights
            const spot1 = new THREE.SpotLight(0xffd700, 20);
            spot1.position.set(5, 10, 5);
            spot1.penumbra = 0.5;
            scene.add(spot1);

            const spot2 = new THREE.SpotLight(0x4444ff, 10); // Cool rim light
            spot2.position.set(-5, 2, -5);
            scene.add(spot2);

            // Load Data
            fetch('wedding_data.json')
                .then(res => res.json())
                .then(data => {
                    cardData = data;
                    createWorld();
                    document.getElementById('loader').style.opacity = 0;
                    setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
                });

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;
            controls.minDistance = 5;
            controls.maxDistance = 20;

            // Resize
            window.addEventListener('resize', onResize);
            animate();
        }

        // --- 2. TEXTURE GENERATION ---
        function createTexture(type) {
            const canvas = document.createElement('canvas');
            const w = 1024; const h = 1400; // High Res
            canvas.width = w; canvas.height = h;
            const ctx = canvas.getContext('2d');

            // 1. Paper Texture (Noise)
            ctx.fillStyle = cardData.theme.paper_color;
            ctx.fillRect(0, 0, w, h);
            
            // Add subtle noise for realism
            for(let i=0; i<50000; i++) {
                ctx.fillStyle = `rgba(0,0,0,${Math.random()*0.03})`;
                ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);
            }

            // 2. Gold Border
            ctx.strokeStyle = cardData.theme.border_color;
            ctx.lineWidth = 20;
            ctx.strokeRect(40, 40, w-80, h-80);
            
            // Inner thin border
            ctx.lineWidth = 5;
            ctx.strokeRect(60, 60, w-120, h-120);

            // 3. Text Setup
            ctx.textAlign = 'center';
            ctx.fillStyle = cardData.theme.text_color;
            const cx = w/2;

            const fontMain = cardData.theme.font;

            if (type === 'front') {
                // ORNAMENTAL TOP
                ctx.font = '40px ' + fontMain;
                ctx.fillText("✦  " + cardData.cover.top_text.toUpperCase() + "  ✦", cx, 300);

                // COUPLE NAME (BIG)
                ctx.font = 'bold 120px ' + fontMain;
                // Add Shadow for embossing effect
                ctx.shadowColor = "rgba(0,0,0,0.2)"; ctx.shadowBlur = 10; ctx.shadowOffsetY = 5;
                ctx.fillText(cardData.cover.couple_name, cx, 650);
                ctx.shadowColor = "transparent";

                // DATE
                ctx.font = '50px ' + fontMain;
                ctx.fillText(cardData.cover.date, cx, 1100);
            }
            else if (type === 'right') {
                // INSIDE RIGHT (Main Invite)
                ctx.font = 'italic 40px ' + fontMain;
                ctx.fillStyle = "#333"; // Darker text for readability
                ctx.fillText(cardData.inside_right.line1, cx, 250);
                ctx.fillText(cardData.inside_right.line2, cx, 320);

                ctx.font = 'bold 90px ' + fontMain;
                ctx.fillStyle = cardData.theme.text_color; // Gold Names
                ctx.fillText(cardData.inside_right.groom, cx, 500);
                
                ctx.font = 'italic 50px ' + fontMain;
                ctx.fillStyle = "#333";
                ctx.fillText("&", cx, 600);

                ctx.font = 'bold 90px ' + fontMain;
                ctx.fillStyle = cardData.theme.text_color;
                ctx.fillText(cardData.inside_right.bride, cx, 720);

                // Divider
                ctx.strokeStyle = cardData.theme.text_color;
                ctx.beginPath(); ctx.moveTo(cx-100, 850); ctx.lineTo(cx+100, 850); ctx.stroke();

                ctx.font = 'bold 50px ' + fontMain;
                ctx.fillStyle = "#333";
                ctx.fillText(cardData.inside_right.date_time, cx, 1000);
                ctx.font = '40px ' + fontMain;
                ctx.fillText(cardData.inside_right.venue, cx, 1100);
            }
            else if (type === 'left') {
                // QUOTE
                ctx.font = 'italic 50px ' + fontMain;
                ctx.fillStyle = cardData.theme.text_color;
                ctx.fillText("“", cx, 500);
                
                ctx.font = 'italic 40px ' + fontMain;
                ctx.fillStyle = "#555";
                ctx.fillText(cardData.inside_left.quote, cx, 600);
                
                ctx.font = '30px ' + fontMain;
                ctx.fillStyle = cardData.theme.text_color;
                ctx.fillText(cardData.inside_left.surah, cx, 700);
            }

            const tex = new THREE.CanvasTexture(canvas);
            tex.anisotropy = 16; // Sharp angles
            return tex;
        }

        // --- 3. CREATE WORLD ---
        function createWorld() {
            // --- A. The Magical Particles ---
            const partGeo = new THREE.BufferGeometry();
            const partCount = 1000;
            const posArray = new Float32Array(partCount * 3);
            
            for(let i=0; i<partCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 30; // Spread out
            }
            partGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            
            // Sparkling Gold material
            const partMat = new THREE.PointsMaterial({
                size: 0.05, color: 0xFFD700, transparent: true, opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            particles = new THREE.Points(partGeo, partMat);
            scene.add(particles);

            // --- B. The Card ---
            cardGroup = new THREE.Group();
            
            const w = 4, h = 6, d = 0.04;
            const geo = new THREE.BoxGeometry(w, h, d);

            // Materials
            // We set emissive to allow the bloom filter to make text glow
            const paperBase = new THREE.MeshStandardMaterial({ 
                color: 0xffffff, roughness: 0.7, metalness: 0.1 
            });
            
            const frontTex = createTexture('front');
            const leftTex = createTexture('left');
            const rightTex = createTexture('right');

            // Use Standard Material with Map
            const matFront = new THREE.MeshStandardMaterial({ map: frontTex, roughness: 0.3 });
            const matLeft = new THREE.MeshStandardMaterial({ map: leftTex, roughness: 0.3 });
            const matRight = new THREE.MeshStandardMaterial({ map: rightTex, roughness: 0.3 });

            // RIGHT LEAF (Static)
            const rightLeaf = new THREE.Mesh(geo, [
                paperBase, paperBase, paperBase, paperBase,
                matRight, paperBase 
            ]);
            rightLeaf.position.x = w/2;
            rightLeaf.castShadow = true; rightLeaf.receiveShadow = true;

            // LEFT LEAF (Moving)
            const leftLeaf = new THREE.Mesh(geo, [
                paperBase, paperBase, paperBase, paperBase,
                matFront, matLeft 
            ]);
            leftLeaf.position.x = -w/2;
            leftLeaf.castShadow = true; leftLeaf.receiveShadow = true;

            // Hinge
            hinge = new THREE.Group();
            hinge.add(leftLeaf);
            
            cardGroup.add(rightLeaf);
            cardGroup.add(hinge);
            
            // Initial Position: Standing slightly tilted
            cardGroup.rotation.x = -0.1;
            hinge.rotation.y = Math.PI; // Closed

            scene.add(cardGroup);
        }

        // --- 4. INTERACTIONS ---
        window.toggleCard = function() {
            // Animate Hinge
            const target = isOpen ? Math.PI : 0.05; // 0.05 prevents z-fighting
            new TWEEN.Tween(hinge.rotation)
                .to({ y: target }, 2000)
                .easing(TWEEN.Easing.Cubic.InOut)
                .start();

            // Animate Camera/Card angle for better view
            const rotTarget = isOpen ? 0 : 0.3;
            new TWEEN.Tween(cardGroup.rotation)
                .to({ x: isOpen ? -0.1 : -0.5, y: isOpen ? 0 : 0.2 }, 2000)
                .easing(TWEEN.Easing.Cubic.Out)
                .start();

            // Change button text
            const btn = document.querySelector('.btn-gold');
            btn.innerText = isOpen ? "OPEN INVITATION" : "CLOSE INVITATION";
            
            isOpen = !isOpen;
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();
            controls.update();
            
            // Rotate particles slowly
            if(particles) particles.rotation.y += 0.001;

            composer.render();
        }
    </script>
</body>
</html>